<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AVS Furnishing Curtain Estimator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    .window-set {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>AVS Furnishing Curtain Estimator</h1>

  <label>Customer Name:
    <input type="text" id="customerName" required />
  </label>
  <label>Phone Number:
    <input type="text" id="phoneNumber" required />
  </label>
  <label>Order Date:
    <input type="date" id="orderDate" required />
  </label>

  <div id="windowContainer"></div>

  <button onclick="addWindowSet()">Add Another Window</button>
  <button onclick="calculateTotal()">Calculate Total</button>
  <button onclick="exportPDF()">Export PDF</button>

  <h2 id="output"></h2>

  <script>
    function addWindowSet() {
      const container = document.getElementById('windowContainer');
      const div = document.createElement('div');
      div.className = 'window-set';
      div.innerHTML = `
        <label>Window Location:</label>
        <input type="text" class="windowLocation" required />

        <label>Length (in inches):</label>
        <input type="number" class="length" required />

        <label>Breadth (in inches):</label>
        <input type="number" class="breadth" required />

        <label>Fabric Name:</label>
        <input type="text" class="fabricName" required />

        <label>Rate per Metre (₹):</label>
        <input type="number" class="ratePerMtr" required />

        <label>Fabric Discount (%):</label>
        <input type="number" class="fabricDiscount" value="0" max="20" required oninput="validateDiscount(this)" />

        <label>Stitching Type:</label>
        <select class="stitchingType">
          <option value="2 pleat">2 pleat</option>
          <option value="3 pleat">3 pleat</option>
          <option value="eyelet">Eyelet</option>
          <option value="ripple">Ripple</option>
        </select>

        <label>Lining Required:</label>
        <select class="lining">
          <option value="no">No</option>
          <option value="yes">Yes</option>
        </select>

        <label>Lining Type:</label>
        <select class="liningType">
          <option value="satin">Satin</option>
          <option value="blackout">Blackout</option>
        </select>

        <label>Number of Belts:</label>
        <input type="number" class="beltQty" value="0" min="0" />

        <label>Rod/Channel Type:</label>
        <select class="rodType">
          <option value="none">None</option>
          <option value="ss rod">SS Rod</option>
          <option value="j silent channel">J Silent Channel</option>
          <option value="al silent channel">AL Silent Channel</option>
        </select>
      `;
      container.appendChild(div);
    }

    function validateDiscount(input) {
      if (parseFloat(input.value) > 20) {
        input.value = 20;
        showToast("Fabric discount cannot be more than 20%!");
      }
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.textContent = message;
      toast.style.position = 'fixed';
      toast.style.bottom = '30px';
      toast.style.left = '50%';
      toast.style.transform = 'translateX(-50%)';
      toast.style.background = '#e74c3c';
      toast.style.color = 'white';
      toast.style.padding = '10px 20px';
      toast.style.borderRadius = '8px';
      toast.style.fontSize = '16px';
      toast.style.zIndex = '1000';
      toast.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
      toast.style.animation = 'fadeInOut 2.5s';
      document.body.appendChild(toast);
      setTimeout(() => { toast.remove(); }, 2500);
    }

    function calculateTotal() {
      const windows = document.querySelectorAll('.window-set');
      let total = 0;

      windows.forEach(window => {
        const length = parseFloat(window.querySelector('.length').value) || 0;
        const breadth = parseFloat(window.querySelector('.breadth').value) || 0;
        const ratePerMtr = parseFloat(window.querySelector('.ratePerMtr').value) || 0;
        const fabricDiscount = parseFloat(window.querySelector('.fabricDiscount').value) || 0;
        const stitchingType = window.querySelector('.stitchingType').value;
        const liningRequired = window.querySelector('.lining').value;
        const liningType = window.querySelector('.liningType').value;
        const beltQty = parseFloat(window.querySelector('.beltQty').value) || 0;
        const rodType = window.querySelector('.rodType').value;

        const panelWidth = 20; // Standard panel width in inches
        const panels = Math.ceil(breadth / panelWidth);

        const fabricLengthMtr = (length + 12) / 39.5; // 12 inches extra for top & bottom margin
        const fabricRequired = fabricLengthMtr * panels;

        const extraFabricForBelts = (beltQty > 0) ? (Math.ceil(beltQty / 2) * 0.5) : 0;
        const totalFabricRequired = fabricRequired + extraFabricForBelts;

        let fabricCost = totalFabricRequired * ratePerMtr;
        const discountAmount = fabricCost * (fabricDiscount / 100);
        fabricCost -= discountAmount;

        let stitchingCostPerCurtain = 0;
        if (stitchingType === 'ripple') {
          stitchingCostPerCurtain = liningRequired === 'yes' ? 500 : 450;
        } else {
          stitchingCostPerCurtain = liningRequired === 'yes' ? 250 : 200;
        }
        const stitchingCost = stitchingCostPerCurtain * panels;

        let liningFabricCost = 0;
        if (liningRequired === 'yes') {
          const liningRate = liningType === 'satin' ? 180 : 250;
          liningFabricCost = fabricLengthMtr * panels * liningRate;
        }

        const beltStitchingCost = beltQty * 200;

        let rodCost = 0;
        if (rodType !== 'none') {
          let rodRate = 0;
          if (rodType === 'ss rod') rodRate = 195;
          else if (rodType === 'j silent channel') rodRate = 210;
          else if (rodType === 'al silent channel') rodRate = 350;

          const rodLengthFeet = breadth / 12;
          rodCost = rodLengthFeet * rodRate;
        }

        const windowTotal = fabricCost + stitchingCost + liningFabricCost + beltStitchingCost + rodCost;
        total += windowTotal;
      });

      const output = document.getElementById('output');
      output.textContent = `Total Estimate: ₹${total.toFixed(2)}`;
    }

    async function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.setFont('Helvetica', 'bold');
      doc.setFontSize(20);
      doc.text('AVS FURNISHINGS', 105, 15, { align: 'center' });

      doc.setFontSize(12);
      doc.setFont('Helvetica', 'normal');
      doc.text(`Customer Name: ${document.getElementById('customerName').value}`, 10, 30);
      doc.text(`Phone Number: ${document.getElementById('phoneNumber').value}`, 10, 40);
      doc.text(`Date: ${document.getElementById('orderDate').value}`, 10, 50);

      let y = 65;
      const windowSets = document.querySelectorAll('.window-set');

      windowSets.forEach((window, index) => {
        doc.setFont('Helvetica', 'bold');
        doc.text(`Window ${index + 1}:`, 10, y);
        y += 8;
        doc.setFont('Helvetica', 'normal');
        const fields = window.querySelectorAll('input, select');
        fields.forEach(field => {
          if (field.value.trim() !== '') {
            const labelText = field.previousElementSibling ? field.previousElementSibling.innerText : '';
            doc.text(`${labelText} ${field.value}`, 10, y);
            y += 8;
          }
        });
        y += 8;
      });

      y += 10;
      const outputText = document.getElementById('output').textContent;
      if (outputText) {
        doc.setFont('Helvetica', 'bold');
        doc.text('Total Estimate:', 10, y);
        y += 8;
        doc.setFont('Helvetica', 'normal');
        const outputLines = doc.splitTextToSize(outputText, 180);
        doc.text(outputLines, 10, y);
      }

      doc.save('avs_furnishing_estimate.pdf');
    }

    document.addEventListener('DOMContentLoaded', () => {
      addWindowSet(); // Add first window automatically
    });
  </script>
</body>
</html>


